---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import HomePage from '../../layouts/HomePage.astro';
import {
	DEFAULT_LOCALE,
	SUPPORTED_LOCALES,
	type Locale,
	isLocale,
} from '../../i18n/config';
import { postsForLocale } from '../../i18n/posts';

export const getStaticPaths = (async () =>
	SUPPORTED_LOCALES.map((lang) => ({
		params: { lang },
	}))) satisfies GetStaticPaths;

const langParam = Astro.params.lang ?? DEFAULT_LOCALE;
const locale: Locale = isLocale(langParam) ? langParam : DEFAULT_LOCALE;
const allPosts = await getCollection('blog');
const latestPosts = postsForLocale(allPosts, locale).slice(0, 3);
---

<HomePage locale={locale} latestPosts={latestPosts} />
