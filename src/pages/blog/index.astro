---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Generate rain drops for Blade Runner effect (50 drops)
// Blade Runner: 负 delay 让雨滴首次加载即分布全屏
const rainTypes = ['normal', 'thin', 'fog', 'skew'];
const rainDrops = Array.from({ length: 80 }, (_, i) => {
	const type = rainTypes[i % 4];
	return {
		id: i,
		left: `${Math.random() * 100}%`,
		delay: `${-5 + Math.random() * 6}s`,
		duration: `${2.5 + Math.random() * (type === 'thin' ? 0.8 : type === 'fog' || type === 'skew' ? 1.4 : 1.2)}s`,
		opacity: type === 'fog' ? 0.12 + Math.random() * 0.1 : 0.2 + Math.random() * 0.25,
		type,
	};
});
const dustParticles = Array.from({ length: 35 }, (_, i) => ({
	left: `${Math.random() * 100}%`,
	top: `${Math.random() * 100}%`,
	size: 4 + Math.random() * 4,
	delay: `${Math.random() * 10}s`,
	duration: `${8 + Math.random() * 12}s`,
}));
---
<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			body.br-page{background:#0a0a12!important;background-image:none!important;min-height:100vh!important}
			body.br-page::before{content:'';position:fixed;inset:0;z-index:-1;background:linear-gradient(180deg,#050508 0%,#0a0a12 20%,#0d1525 50%,#0a0a12 80%,#050508 100%)}
			body.br-page::after{content:'';position:fixed;inset:0;z-index:-1;background:radial-gradient(80% 50% at 50% 20%,rgba(0,150,200,.15) 0%,transparent 50%),radial-gradient(60% 40% at 80% 80%,rgba(255,100,150,.08) 0%,transparent 40%);animation:br-fog 15s ease-in-out infinite alternate;pointer-events:none}
			@keyframes br-fog{0%{opacity:.7;transform:translate(-2%,-1%)}100%{opacity:1;transform:translate(2%,1%)}}
			body.br-page .br-rain{position:fixed;inset:0;pointer-events:none;z-index:6;overflow:hidden}
			body.br-page .br-rain-drop{position:absolute;top:-20px;width:6px;height:38px;clip-path:polygon(1.5px 0,4.5px 0,6px 100%,0 100%);background:linear-gradient(to bottom,transparent 0%,rgba(255,200,150,.35) 40%,rgba(255,180,120,.5) 70%,transparent 100%);animation:br-rain linear infinite}
			@keyframes br-rain{to{transform:translateY(100vh)}}
			body.br-page .br-scanlines{position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.55) 2px,rgba(0,0,0,.55) 4px);pointer-events:none;z-index:4;opacity:1}
			body.br-page .br-spotlight{position:fixed;top:0;left:0;width:calc(hypot(100vw, 100vh)*1.3/1.41421356);height:calc(hypot(100vw, 100vh)*1.3/1.41421356);pointer-events:none;z-index:5}
			body.br-page .br-spotlight-tl{position:absolute;inset:0;transform-origin:0 0;background:conic-gradient(from 180deg at 0 0,transparent 0deg 303deg,rgba(255,220,200,.06) 306deg,rgba(255,210,180,.2) 309deg,rgba(255,200,160,.35) 312deg,rgba(255,210,180,.2) 315deg,rgba(255,220,200,.06) 318deg,transparent 321deg 360deg);animation:br-spotlight-sweep-tl 10s ease-in-out infinite}
			body.br-page .br-spotlight-tr{position:absolute;inset:0;transform-origin:100% 0;background:conic-gradient(from 180deg at 100% 0,transparent 0deg 33deg,rgba(255,220,200,.06) 36deg,rgba(255,210,180,.2) 39deg,rgba(255,200,160,.35) 42deg,rgba(255,210,180,.2) 45deg,rgba(255,220,200,.06) 48deg,transparent 51deg 360deg);animation:br-spotlight-sweep-tr 12s ease-in-out infinite;animation-delay:-2s}
			@keyframes br-spotlight-sweep-tl{0%{transform:rotate(0deg)}50%{transform:rotate(-90deg)}100%{transform:rotate(0deg)}}
			@keyframes br-spotlight-sweep-tr{0%,100%{transform:rotate(0deg)}50%{transform:rotate(90deg)}}
			body.br-page .br-flicker{position:fixed;inset:0;background:radial-gradient(ellipse 25% 30% at 85% 20%,rgba(255,100,150,.45) 0%,transparent 55%),radial-gradient(ellipse 22% 25% at 15% 70%,rgba(0,200,255,.4) 0%,transparent 55%),radial-gradient(ellipse 28% 35% at 70% 85%,rgba(255,180,80,.4) 0%,transparent 55%);animation:br-neon-flicker-glow 4s ease-in-out infinite;pointer-events:none;z-index:0}
			@keyframes br-neon-flicker-glow{0%,100%{opacity:.8}25%{opacity:1}50%{opacity:.5}75%{opacity:.95}}
			body.br-page .br-haze{position:fixed;inset:0;background:radial-gradient(ellipse 100% 80% at 50% 50%,rgba(60,80,120,.08) 0%,transparent 60%);animation:br-haze-drift 20s ease-in-out infinite alternate;pointer-events:none;z-index:1}
			@keyframes br-haze-drift{0%{opacity:.5;transform:translate(3%,2%) scale(1.05)}100%{opacity:1;transform:translate(-3%,-2%) scale(.95)}}
			body.br-page .br-vignette{position:fixed;inset:0;background:radial-gradient(ellipse 80% 80% at 50% 50%,transparent 40%,rgba(0,0,0,.4) 100%);pointer-events:none;z-index:3}
			body.br-page .br-rain-drop--thin{width:4px;height:28px;clip-path:polygon(.5px 0,3.5px 0,4px 100%,0 100%)}
			body.br-page .br-rain-drop--fog{opacity:.15;filter:blur(.5px)}
			body.br-page .br-rain-drop--skew{animation-name:br-rain-skew}
			@keyframes br-rain-skew{to{transform:skewX(-3deg) translateY(100vh)}}
			body.br-page .br-dust{position:fixed;inset:0;pointer-events:none;z-index:2;overflow:hidden}
			body.br-page .br-dust-particle{position:absolute;border-radius:50%;background:rgba(255,230,190,.85);box-shadow:0 0 12px rgba(255,200,150,.7),0 0 24px rgba(255,180,120,.4);animation:br-dust-float linear infinite}
			@keyframes br-dust-float{0%{transform:translate(0,0) scale(1);opacity:.7}25%{transform:translate(15px,-8px) scale(1.1);opacity:.95}50%{transform:translate(-10px,-20px) scale(.9);opacity:.8}75%{transform:translate(8px,-15px) scale(1.05);opacity:.9}100%{transform:translate(0,-30px) scale(1);opacity:.7}}
			body.br-page main{position:relative;z-index:7;width:960px}
			body.br-page .title,body.br-page .date{color:rgba(200,220,255,.9)}
			body.br-page .date{color:rgba(150,180,220,.6)}
			body.br-page ul{display:flex;flex-wrap:wrap;gap:2rem;list-style:none;margin:0;padding:0}
			body.br-page ul li{width:calc(50% - 1rem)}
			body.br-page ul li *{text-decoration:none}
			body.br-page ul li:first-child{width:100%;margin-bottom:1rem;text-align:center}
			body.br-page ul li:first-child img{width:100%}
			body.br-page ul li:first-child .title{font-size:2.369rem}
			body.br-page ul li a{display:block;position:relative;padding:1rem;border-radius:4px;border:1px solid transparent;transition:border-color .2s,box-shadow .3s}
			body.br-page ul li a:hover{border-color:rgba(100,180,185,.5);box-shadow:0 0 8px rgba(100,180,185,.35),0 0 20px rgba(255,150,80,.15);animation:br-neon .3s ease-in-out infinite}
			@keyframes br-neon{0%,100%{box-shadow:0 0 8px rgba(100,180,185,.35),0 0 20px rgba(255,150,80,.15)}50%{box-shadow:0 0 5px rgba(100,180,185,.25),0 0 14px rgba(255,150,80,.1)}}
			body.br-page ul li a:hover .title{animation:br-glitch .3s ease-in-out;color:rgb(130,200,205);text-shadow:0 0 8px rgba(100,180,185,.5),0 0 20px rgba(255,180,80,.2)}
			@keyframes br-glitch{0%{transform:translate(0)}20%{transform:translate(-2px,2px);text-shadow:2px 0 rgba(180,80,100,.6),-2px 0 rgba(100,180,185,.6)}40%{transform:translate(2px,-2px)}60%{transform:translate(-1px,1px)}80%{transform:translate(1px,-1px)}100%{transform:translate(0)}}
			body.br-page ul li a:hover .date{color:rgba(255,180,100,.95);text-shadow:0 0 10px rgba(255,180,80,.6)}
			body.br-page .img-wrapper{position:relative;margin-bottom:.5rem;border-radius:4px;overflow:hidden}
			body.br-page .img-wrapper::before{content:'';position:absolute;left:0;right:0;top:-20px;height:10px;z-index:3;background:linear-gradient(90deg,transparent,rgba(255,200,120,.9),rgba(255,190,100,.95),rgba(255,200,120,.9),transparent);box-shadow:0 0 20px rgba(255,180,80,.85),0 0 40px rgba(255,150,60,.4);pointer-events:none;transition:top 1.2s linear}
			body.br-page ul li a:hover .img-wrapper::before{top:100%}
			body.br-page .img-wrapper::after{content:'';position:absolute;inset:0;z-index:2;box-shadow:inset 0 0 25px rgba(100,180,185,.1),inset 0 0 50px rgba(255,180,80,.04);pointer-events:none;opacity:0;transition:opacity .4s ease}
			body.br-page ul li a:hover .img-wrapper::after{opacity:1}
			body.br-page ul li img{display:block;width:100%;height:auto;filter:saturate(.75) contrast(1.05) brightness(.88) sepia(.15) hue-rotate(5deg);transition:filter .3s,box-shadow .3s}
			body.br-page ul li a:hover img{filter:saturate(.9) contrast(1.1) brightness(.95) sepia(.08) hue-rotate(2deg);box-shadow:0 0 15px rgba(100,180,185,.2),0 0 30px rgba(255,150,80,.12)}
			body.br-page .title,body.br-page .date{margin:0;line-height:1}
			@media(max-width:720px){body.br-page ul{gap:.5em}body.br-page ul li{width:100%;text-align:center}body.br-page ul li:first-child{margin-bottom:0}body.br-page ul li:first-child .title{font-size:1.563em}}
		</style>
	</head>
	<body class="br-page">
		<div class="br-spotlight" aria-hidden="true">
			<div class="br-spotlight-tr"></div>
			<div class="br-spotlight-tl"></div>
		</div>
		<div class="br-flicker" aria-hidden="true"></div>
		<div class="br-haze" aria-hidden="true"></div>
		<div class="br-vignette" aria-hidden="true"></div>
		<div class="br-rain" aria-hidden="true">
			{
				rainDrops.map((drop) => (
					<div
						class={`br-rain-drop br-rain-drop--${drop.type}`}
						style={{
							left: drop.left,
							animationDelay: drop.delay,
							animationDuration: drop.duration,
							opacity: drop.opacity,
						}}
					/>
				))
			}
		</div>
		<div class="br-dust" aria-hidden="true">
			{dustParticles.map((p) => (
				<div
					class="br-dust-particle"
					style={{
						left: p.left,
						top: p.top,
						width: p.size,
						height: p.size,
						animationDelay: p.delay,
						animationDuration: p.duration,
					}}
				/>
			))}
		</div>
		<div class="br-scanlines" aria-hidden="true"></div>

		<Header />
		<main>
			<section>
				<ul>
					{
						posts.map((post) => (
							<li>
								<a href={`/blog/${post.id}/`}>
									{post.data.heroImage && (
										<div class="img-wrapper">
											<Image width={720} height={360} src={post.data.heroImage} alt="" />
										</div>
									)}
									<h4 class="title">{post.data.title}</h4>
									<p class="date">
										<FormattedDate date={post.data.pubDate} />
									</p>
								</a>
							</li>
						))
					}
				</ul>
			</section>
		</main>
		<Footer />
	</body>
</html>
